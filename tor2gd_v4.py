# -*- coding: utf-8 -*-
"""Torrent Google Drive By Me.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1SIE0xKRAnCvIMy7XttLPKSMezZUj1LpA

**Torrent To Google Drive/ShareDrive BY
RH Rafiz**
"""

# ржкрзНрж░рзЯрзЛржЬржирзАрзЯ рж▓рж╛ржЗржмрзНрж░рзЗрж░рж┐ ржЗржирж╕рзНржЯрж▓ ржХрж░рж╛
!pip install -q libtorrent

# ржоржбрж┐ржЙрж▓ ржЗржорзНржкрзЛрж░рзНржЯ ржХрж░рж╛
import libtorrent as lt
import time
import os
import shutil
from google.colab import drive
from google.colab import output

print("рж▓рж╛ржЗржмрзНрж░рзЗрж░рж┐ ржЗржирж╕рзНржЯрж▓ ржПржмржВ ржЗржорзНржкрзЛрж░рзНржЯ рж╕ржорзНржкржирзНржи рж╣рзЯрзЗржЫрзЗред")
# ржЧрзБржЧрж▓ ржбрзНрж░рж╛ржЗржн ржорж╛ржЙржирзНржЯ ржХрж░рж╛ рж╣ржЪрзНржЫрзЗ
# ржПржЯрж┐ ржХрж░рж╛рж░ ржорж╛ржзрзНржпржорзЗ Colab ржЖржкржирж╛рж░ ржЧрзБржЧрж▓ ржбрзНрж░рж╛ржЗржнрзЗрж░ ржлрж╛ржЗрж▓ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржХрж░рж╛рж░ ржЕржирзБржорждрж┐ ржкрж╛ржмрзЗ
drive.mount('/content/drive')

# ржЯрж░рзЗржирзНржЯ рж╕рзЗрж╢ржи рж╢рзБрж░рзБ ржХрж░рж╛рж░ ржЬржирзНржп рж╕рзЗржЯрж┐ржВрж╕
ses = lt.session()
ses.listen_on(6881, 6891)

# рж▓рзЛржХрж╛рж▓ ржбрж╛ржЙржирж▓рзЛржбрзЗрж░ ржЬржирзНржп ржПржХржЯрж┐ ржлрзЛрж▓рзНржбрж╛рж░ рждрзИрж░рж┐ ржХрж░рж╛ (Colab environment-ржП)
download_path_local = "/content/drive/MyDrive/Torrents"
if not os.path.exists(download_path_local):
    os.makedirs(download_path_local)

# ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░ ржХрж╛ржЫ ржерзЗржХрзЗ ржЗржиржкрзБржЯ ржирзЗржУрзЯрж╛
magnet_link = input("ржЖржкржирж╛рж░ ржорзНржпрж╛ржЧржирзЗржЯ рж▓рж┐ржВржХржЯрж┐ ржПржЦрж╛ржирзЗ ржкрзЗрж╕рзНржЯ ржХрж░рзБржи: ")
gdrive_folder_path = "/content/drive/MyDrive/MyTorrents"

# ржЧрзБржЧрж▓ ржбрзНрж░рж╛ржЗржнрзЗрж░ ржлрзЛрж▓рзНржбрж╛рж░ржЯрж┐ ржирж╛ ржерж╛ржХрж▓рзЗ рждрзИрж░рж┐ ржХрж░рж╛
if not os.path.exists(gdrive_folder_path):
    os.makedirs(gdrive_folder_path)
    print(f"'{gdrive_folder_path}' ржлрзЛрж▓рзНржбрж╛рж░ржЯрж┐ рждрзИрж░рж┐ ржХрж░рж╛ рж╣рзЯрзЗржЫрзЗред")

# ржЯрж░рзЗржирзНржЯ ржпрзЛржЧ ржХрж░рж╛
params = {'save_path': download_path_local}
handle = lt.add_magnet_uri(ses, magnet_link, params)

print("\nржЯрж░рзЗржирзНржЯрзЗрж░ ржорзЗржЯрж╛ржбрзЗржЯрж╛ ржбрж╛ржЙржирж▓рзЛржб ржХрж░рж╛ рж╣ржЪрзНржЫрзЗ...")
while not handle.has_metadata():
    time.sleep(1)

tor_info = handle.get_torrent_info()
file_name = tor_info.name()
print(f"ржбрж╛ржЙржирж▓рзЛржб рж╢рзБрж░рзБ рж╣ржЪрзНржЫрзЗ: {file_name}")

# рж░рж┐рзЯрзЗрж▓-ржЯрж╛ржЗржо рж╕рзНржЯрзНржпрж╛ржЯрж╛рж╕ ржжрзЗржЦрж╛ржирзЛрж░ рж▓рзБржк
while handle.status().state not in [lt.torrent_status.seeding, lt.torrent_status.finished]:
    s = handle.status()
    progress = s.progress * 100
    download_speed = s.download_rate / 1024 / 1024  # MB/s
    peers = s.num_peers

    # ржЖржЙржЯржкрзБржЯ ржХрзНрж▓рж┐рзЯрж╛рж░ ржХрж░рзЗ ржирждрзБржи рж╕рзНржЯрзНржпрж╛ржЯрж╛рж╕ ржжрзЗржЦрж╛ржирзЛ
    output.clear()

    print(f"ржлрж╛ржЗрж▓рзЗрж░ ржирж╛ржо: {file_name}")
    print(f"ржЕржЧрзНрж░ржЧрждрж┐: {progress:.2f}%")
    # ржПржХржЯрж┐ рж╕рж╛ржзрж╛рж░ржг ржЯрзЗржХрзНрж╕ржЯ-ржнрж┐рждрзНрждрж┐ржХ ржкрзНрж░рзЛржЧрзНрж░рзЗрж╕ ржмрж╛рж░
    progress_bar = 'тЦИ' * int(progress / 2) + '-' * (50 - int(progress / 2))
    print(f"[{progress_bar}]")
    print(f"ржбрж╛ржЙржирж▓рзЛржбрзЗрж░ ржЧрждрж┐: {download_speed:.2f} MB/s")
    print(f"ржкрж┐рзЯрж╛рж░рж╕ (Peers): {peers}")
    print(f"рж╕рзНржЯрзНржпрж╛ржЯрж╛рж╕: {s.state}")

    time.sleep(5)

output.clear()
print(f"тЬЕ ржбрж╛ржЙржирж▓рзЛржб рж╕ржорзНржкржирзНржи: {file_name}")

# ржбрж╛ржЙржирж▓рзЛржб рж╣ржУрзЯрж╛ ржлрж╛ржЗрж▓ ржЧрзБржЧрж▓ ржбрзНрж░рж╛ржЗржнрзЗ ржорзБржн ржХрж░рж╛
source_file = os.path.join(download_path_local, file_name)
destination_file = os.path.join(gdrive_folder_path, file_name)

print(f"\nржлрж╛ржЗрж▓ржЯрж┐ ржЧрзБржЧрж▓ ржбрзНрж░рж╛ржЗржнрзЗ ржорзБржн ржХрж░рж╛ рж╣ржЪрзНржЫрзЗ...")
shutil.move(source_file, destination_file)
print(f"ЁЯЪА рж╕ржлрж▓ржнрж╛ржмрзЗ '{file_name}' ржлрж╛ржЗрж▓ржЯрж┐ ржЖржкржирж╛рж░ ржЧрзБржЧрж▓ ржбрзНрж░рж╛ржЗржнрзЗ рж╕рзЗржн ржХрж░рж╛ рж╣рзЯрзЗржЫрзЗ!")
print(f"ржбрзНрж░рж╛ржЗржнрзЗрж░ ржкрж╛рже: {destination_file}")